# golangci-lint Configuration

This document describes the golangci-lint configuration used in the docker-network-viz project.

## Overview

The `.golangci.yml` file configures golangci-lint to enforce code quality standards consistent with Ocom Go development practices.

## Enabled Linters

### Default Linters

| Linter | Description |
|--------|-------------|
| errcheck | Checks for unchecked errors |
| gosimple | Suggests code simplifications |
| govet | Reports suspicious constructs |
| ineffassign | Detects ineffective assignments |
| staticcheck | Comprehensive static analysis |
| unused | Checks for unused code |

### Additional Linters

| Linter | Description |
|--------|-------------|
| bodyclose | Checks HTTP response body is closed |
| dogsled | Checks for too many blank identifiers |
| dupl | Detects code duplication |
| goconst | Finds repeated strings that could be constants |
| gocritic | Comprehensive Go code linter |
| gofmt | Checks code formatting |
| goimports | Checks import ordering and formatting |
| goprintffuncname | Checks printf-like function names |
| gosec | Security-focused checks |
| misspell | Finds misspelled words |
| nakedret | Finds naked returns in long functions |
| noctx | Checks for HTTP requests without context |
| nolintlint | Validates nolint directives |
| prealloc | Finds slice declarations that could be preallocated |
| revive | Fast, configurable linter (replacement for golint) |
| rowserrcheck | Checks sql.Rows.Err is checked |
| stylecheck | Style checks |
| unconvert | Removes unnecessary type conversions |
| whitespace | Checks for leading/trailing whitespace |

## Linter Settings

### errcheck

- Type assertions are checked
- Blank assignments are not flagged (allows intentional `_ = function()`)

### govet

- All analyzers enabled except `fieldalignment`

### gocritic

- Enabled tags: diagnostic, style
- Disabled checks:
  - `whyNoLint`: Allows nolint without explanation
  - `hugeParam`: Allows large parameters
  - `rangeValCopy`: Allows copying in range loops

### goimports

- Local imports (git.o.ocom.com.au/go/docker-network-viz) are grouped after third-party imports

### revive

Enabled rules:
- blank-imports
- context-as-argument
- context-keys-type
- dot-imports
- error-return
- error-strings
- error-naming
- exported
- increment-decrement
- indent-error-flow
- package-comments
- range
- receiver-naming
- time-naming
- unexported-return
- var-declaration
- var-naming

### stylecheck

- All checks enabled except ST1000 (package comments)

### gosec

- G104 excluded (handled by errcheck)

### dupl

- Threshold: 150 tokens

### nakedret

- Allowed in functions with <= 5 lines

## Exclusion Rules

### Test Files (_test.go)

The following linters are disabled for test files:
- dupl (duplicate code is acceptable in tests)
- gosec (security checks less relevant)
- goconst (constants in tests can be inline)
- octalLiteral (needed for file permissions)
- Shadow warnings

### cmd/ Directory

- revive package-comments rule is disabled

## Excluded Directories

- vendor/
- dist/
- bin/

## Running Lint

```bash
# Via Makefile
make lint

# Directly
golangci-lint run -v ./...
```

## Fixing Issues

Many linters support automatic fixes:

```bash
golangci-lint run --fix ./...
```

## Common Issues and Solutions

### Error return value not checked

**Issue**: Functions returning errors that aren't checked.

**Solution**: Handle the error or explicitly ignore it:
```go
// Handle the error
if err := doSomething(); err != nil {
    return err
}

// Explicitly ignore (when safe)
_ = doSomething()
```

### Code duplication

**Issue**: Similar code blocks detected.

**Solution**: Extract common functionality into a shared function.

### Unused code

**Issue**: Variables, functions, or types that aren't used.

**Solution**: Remove unused code or add a `//nolint:unused` comment if needed for future use.

## Customization

To modify linter settings, edit `.golangci.yml`. Common customizations:

1. **Disable a linter globally**:
   ```yaml
   linters:
     disable:
       - lintername
   ```

2. **Exclude specific files**:
   ```yaml
   issues:
     exclude-rules:
       - path: specific_file.go
         linters:
           - lintername
   ```

3. **Exclude by text pattern**:
   ```yaml
   issues:
     exclude-rules:
       - text: "pattern to match"
         linters:
           - lintername
   ```
